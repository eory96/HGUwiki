<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

    <title>회원가입</title>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light" style="background-color: #e3f2fd;">
        <a class="navbar-brand" href="index.html"><img src="https://firebasestorage.googleapis.com/v0/b/hgudemo.appspot.com/o/logo3.png?alt=media&token=00497b74-c63c-457a-a620-1b8c19e2d1b2" alt="" style="height: 50px; width: auto;">&nbsp;한동위키</a>        
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
            </button>
              
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
              <ul class="navbar-nav mr-auto">
                
                <!--<li class="nav-item">
                  <a class="nav-link" href="#">Link</a>
                </li>-->
                <!--<li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Dropdown
                  </a>
                  <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                    <a class="dropdown-item" href="#">Action</a>
                    <a class="dropdown-item" href="#">Another action</a>
                    <div class="dropdown-divider"></div>
                    <a class="dropdown-item" href="#">Something else here</a>
                  </div>
                </li>-->
                <li class="nav-item">
                  <a class="nav-link disabled" href="login.html" id="loginmenu">login</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link disabled" href="join.html" id="joinmenu">회원가입</a>
                </li>
                
              </ul>
              
              <div class="nav justify-content-end">
                <input class="form-control col-sm-8" type="search" placeholder="Search" aria-label="Search" id="search">
                <button class="btn btn-outline-success col-sm-4" id="search_btn">Search</button>
              </div>
              <!--여기 search 부분에 내용을 검색시 content부분으로 넘어갈수 있도록 해야하는 상황.-->
            
                
            </div>
            
          </nav>
    <hr>

    <!--가입 폼 시작-->
    <div class="container">
        <br>
        <br>
           <p class="text-center"><a href="index.html"><img src="https://firebasestorage.googleapis.com/v0/b/hgudemo.appspot.com/o/logo3.png?alt=media&token=00497b74-c63c-457a-a620-1b8c19e2d1b2" style="width: 300px; height: auto;"></a></p> 
        <br>
        <br>
          <div class="row">
            <div class="col-lg-3"></div>

            <div class="col-lg-6">
              <div class="form-group">
                <label for="email">이메일</label>
                <input type="email" class="form-control" id="email">
              </div>
            </div>

            <div class="col-lg-3"></div>
          </div>


          <div class="row">
            <div class="col-lg-3"></div>

            <div class="col-lg-6">
              <div class="form-group">
                <label for="email">닉네임</label>
                <input type="email" class="form-control" id="name">
              </div>
            </div>

            <div class="col-lg-3"></div>
          </div>
         
          <div class="row">
            <div class="col-lg-3"></div>

            <div class="col-lg-6">
              <div class="form-group">
                <label for="email">비밀번호</label>
                <input type="password" class="form-control" id="pwd">
              </div>
            </div>

            <div class="col-lg-3"></div>
          </div>

          <div class="row">
            <div class="col-lg-3"></div>

            <div class="col-lg-6">
              <div class="form-group">
                <label for="email">비밀번호 확인</label>
                <input type="password" class="form-control" id="pwd2">
              </div>
            </div>

            <div class="col-lg-3"></div>
          </div>
         
          <p class="text-center"><button type="button" class="btn btn-primary join" style="width: 540px;">가입하기</button></p>
         
    </div>
    <!-- 가입 폼 끝 -->

    <footer style="background-color: #e3f2fd; color: #969696">
      
        <div class="container">
            <br>
            <div class="row">
                <div class="col-sm-2" style="text-align: center;">copyright <br>&copy; 2018 빛쟁이</div>
                <div class="col-sm-8">
                    <p><img src="https://firebasestorage.googleapis.com/v0/b/hgudemo.appspot.com/o/copyright.png?alt=media&token=14511597-5396-473f-baef-f3d119e8781e"></p>
                   &nbsp;이 저작물은 CC BY-NC-SA 2.0 KR에 따라 이용할 수 있습니다. (단, 라이선스가 명시된 일부 문서 및 삽화 제외) <br>
                     기여하신 문서의 저작권은 각 기여자에게 있으며,각 기여자는 기여하신 부분의 저작권을 갖습니다.
                </div>
                <div class="col-sm-2"><h4 style="text-align: center;">관련 협회</h4>
                    <div class="list-group">
                        <a href="#">Hisnet</a>
                        <a href="#">Handong University</a>
                        <!--<a href="#">눈을감자 존맛</a>-->
                    </div>
                </div>
            </div>
        </div>
    </footer>


    <!--optional javascript-->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <script src="https://www.gstatic.com/firebasejs/4.9.1/firebase.js"></script>
<script>

//냘짜 함수
var d = new Date();
var year = d.getFullYear().toString();
var month = (d.getMonth() + 1).toString();
var day = d.getDate().toString();
var hours = d.getHours().toString();
var min = d.getMinutes().toString();
var sec = d.getSeconds().toString();
var currentTime = parseInt(year + month + day+ hours + min + sec);

var emailAuth;
var firebaseDatabase;
var userInfo;
var name;
  // Initialize Firebase
  var config = {
          apiKey: "AIzaSyB_jfkBeotBufyU_-0YAG8D-8BII_ndst4",
          authDomain: "hgudemo.firebaseapp.com",
          databaseURL: "https://hgudemo.firebaseio.com",
          projectId: "hgudemo",
          storageBucket: "hgudemo.appspot.com",
          messagingSenderId: "464898447701"
        };
  
firebase.initializeApp(config);
//이메일 인증 객체
emailAuth = firebase.auth();
firebaseDatabase=firebase.database();
// You can retrieve services via the defaultApp variable...
//var defaultStorage = defaultApp.storage();
//var defaultDatabase = defaultApp.database();


$(document).ready(function(){
  
  //가입버튼 눌렀을 때
  $(document).on('click','.join',function(){
    var email = $('#email').val();
    var password = $('#pwd').val();
    var comfirm_password=$('#pwd2').val();
    //var imageURL = "https://www.w3schools.com/bootstrap/img_avatar3.png";
    name = $('#name').val();

//이메일로 가입 버튼 눌렀을 때 작동되는 함수
  if(password==comfirm_password){
    emailAuth.createUserWithEmailAndPassword(email, password).then(function(user) {
    //var user = emailAuth.currentUser;
    userInfo = user;
    //console.log("userInfo/"+userInfo); //오브젝트 타입
    //console.log("userInfo.currentUser/"+userInfo.currentUser); //안됨
    //console.log("userInfo.uid/"+userInfo.uid); //vPArtCHqPpOeIOpidEfug0Kgq3v1
    
    //성공했을 때 작동되는 함수
    logUser();
    

    }, function(error) {
    //에러가 발생했을 때 
      var errorCode = error.code;
      var errorMessage = error.message;
      alert(errorMessage);
   
    });
  }
  else{
    alert("비밀번호가 일치하지 않습니다!!")
  }
//가입 성공했을 때 호출 되는 함수
  function logUser(){
    var ref = firebaseDatabase.ref("users/"+userInfo.uid); //유저라는 부모 키 에
    var obj = {
        name: name,
        createtime : currentTime,
        email: email,
        userkey:userInfo.uid
        //imageURL: imageURL
    };

    ref.set(obj); // 고유한 자식 키가 하나 생셩이 되면서 json 삽입
    alert("가입성공");

    //메인 페이지로 이동시키고 세션 저장시키기
    window.location.href = "index.html"
  }

  });
  $(document).on('click','#search_btn',function(){
          console.log("내용검색한 결과를 보여주자!!");
          //document.getElementById("search_btn").href="textedit.html"
          
          searchResult();
      });

});
      
      
function searchResult() {
  var title = document.getElementById('search').value;
  location.href="content.html#" + title + ":" + "search";
}
            
            
            
            
            
            
    </script>
</body>
</html>